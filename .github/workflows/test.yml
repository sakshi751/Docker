name: Extract JSON Details

on:
  push:
    branches:
      - main

jobs:
  extractDetails:
    runs-on: ubuntu-latest

    steps:
      - name: Access JSON data
        id: access
        run: |
          # Set the JSON data as a string
          echo "{\"id\": \"12345\", \"name\": \"example\", \"description\": \"This is an example\"}" >> json_data.json

      - name: Extract Details
        id: extract
        run: |
          # Parse the JSON data and extract details based on input value using jq
          json_data=$(cat json_data.json)
          value_needed="example"  # Update this with the value you want to search for

          # Validate JSON structure
          valid_json=$(echo "$json_data" | jq empty)

          if [ "$valid_json" == "" ]; then
            echo "Invalid JSON data: $json_data"
          else
            # Escape inner double quotes in the JSON data
            escaped_json_data=$(echo "$json_data" | sed 's/"/\\"/g')

            # Extract details using jq
            details=$(echo "$escaped_json_data" | jq --arg value "$value_needed" 'select(.name == $value).description')

            echo "Extracted Details: $details"

            # Store the extracted details as an output
            echo "::set-output name=details::$details"
          fi

      - name: Use the extracted details
        run: |
          # Access the extracted details
          extracted_details="${{ steps.extract.outputs.details }}"
          echo "Extracted Details: $extracted_details"
